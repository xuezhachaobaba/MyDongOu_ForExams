## B. 史诗 - 智能排考
### B1. 功能特性: 考务基础设置
_(目标: 在排考前，让系统理解这场考试的所有基础信息)_

| **作为 (As a)** | **我想要 (I want to)** | **以便于 (So that)** | **优先级** | **备注** |
| --- | --- | --- | --- | --- |
| 排考负责人 | 创建一场新的考试（如：“10月月测”），并设置好**考试的科目、日期和时长**（如：语文150min） | 系统能知道这次排考任务的总量和时段，并用于 **S-E-01** 的时长计算 | **High** |  |
| 排考负责人 | 设定本次考试的“**考场模式**” | 系统能按“周测（原班教室）”或“月测（打乱考场）”的模式去分配考场，满足 **H-E-06** | **High** | 详见 R-E-S-001 细则 |
| 排考负责人 | 导入所有学生的“**选课情况**”（如：物化生） | 在“打乱考场”模式下，系统能正确分配学生到考场或自习室，满足 **H-E-07** | **High** |  |
| 排考负责人 | 系统能自动导入所有老师（尤其是跨段老师）的**最终版课表** | 在排考时，系统能自动规避老师的“授课时间”，满足 **H-E-02** 硬冲突 | **High** |  |


### B2. 功能特性: 排考规则配置
_(目标: 将排考的 V2 规则“翻译”给系统，核心是公平性定义)_

| **作为 (As a)** | **我想要 (I want to)** | **以便于 (So that)** | **优先级** | **备注** |
| --- | --- | --- | --- | --- |
| 排考负责人 | 录入或导入老师的“**固定坐班**”任务（如：第9节课） | 系统能将这些任务计入总时长，使 **H-E-09** 规则生效 | **Medium** |  |
| 排考负责人 | 录入“**请假**”的教师及不可用时段 | 系统能 100% 规避这些时段，满足 **H-E-03** | **High** |  |
| 排考负责人 | 设置“**学科回避**”规则 | 系统不会安排“语文老师”监考“语文”，满足 **H-E-05** | **High** |  |
| 排考负责人 | 设置“**改卷硬约束**”规则（如：科目考完后 T+1 天不可监考） | 系统能自动将相关科目老师在后续时段设为“不可用”，满足 **H-E-04** | **High** |  |
| 排考负责人 | 设置不同任务的“**负荷系数**” | 例如：监考=1.0，自习坐班=0.5。系统在计算“总负荷”时，能**更公平地量化**不同类型工作的强度。 | **High** | ****S-E-02 的算法基础 |
| 排考负责人 | 设置“**历史公平性**”的计算规则（如：`总负荷 = 0.5 * 本次 + 0.5 * 历史`） | 系统能知道如何计算 **S-E-01** 这个核心软约束 | **High** |  |
| 排考负责人 | 设置其他软约束的**权重**（如：S-E-04午休保障 vs S-E-05任务集中度） | 当软约束冲突时，系统能知道优先满足哪一个 | **Medium** |  |


### B3. 功能特性: 智能排考与分析
_(目标: 一键生成公平、无冲突的监考表，并提供数据支撑)_

| **作为 (As a)** | **我想要 (I want to)** | **以便于 (So that)** | **优先级** | **备注** |
| --- | --- | --- | --- | --- |
| 排考负责人 | **一键启动“智能排考”** | 系统能基于所有 V2 规则，自动生成一个没有硬冲突、且“相对公平”的监考表草案 | **High** |  |
| 排考负责人 | 在生成的草案旁，看到一份“**公平性统计报表**” | 我能直观地看到每位老师的“**历史核算负荷**”、“**本次核算负荷**”、“**加权总负荷**” (S-E-01)，以及“长时科目次数”(S-E-03) | **High** | **核心功能**  |
| 排考负责人 | 快速筛选和定位“**不均衡**”的教师 | 例如，我能一键查看“总负荷最高”的5位老师，或“违反午休保障 (S-E-04)”的老师 | **Medium** |  |


### B4. 功能特性: 监考表微调与发布
_(目标: 在系统基础上进行人工干预，并确保结果准确传达)_

| **作为 (As a)** | **我想要 (I want to)** | **以便于 (So that)** | **优先级** | **备注** |
| --- | --- | --- | --- | --- |
| 排考负责人 | 在监考表草案上，通过“拖拽”来**手动调整**监考老师 | 当我对系统自动分配不满意时，能快速进行人工干预 | **High** |  |
| 排考负责人 | 当我“手动调整”时，系统能**实时提醒**我 | 这个调整是否造成了新的**硬冲突**（如 H-E-02 授课冲突） | **High** |  |
| 排考负责人 | 当我“手动调整”时，“**公平性统计报表**”能**实时刷新** | 让我看到这个调整对“加权总负荷” (S-E-01) 造成的影响 | **Medium** |  |
| 排考负责人 | “一键发布”最终监考安排 | 所有相关老师都能在自己的系统上收到**个人版**的监考通知 | **Low** |  |
| 排考负责人 | 导出完整的监考表（总表、分时段表、分教师表） | 满足我打印纸质版存档或在工作群里公示的需求 | **Low** |  |


## C. 核心规则定义 (V2)
### C2. 排考约束 (Exam)
#### C2.1. 硬约束 (H) - 必须 100% 满足
| **约束ID** | **约束类型** | **规则描述** | **备注** |
| --- | --- | --- | --- |
| H-E-01 | 基础时空冲突 | **教师监考/考场冲突**：同一时间，教师只能监考一个考场；考场只能安排一场考试。 | 基础规则。 |
| H-E-02 | 基础时空冲突 | **教师授课冲突 (R-E-T-001)**：教师的“监考时间” _不能_ 与其在其他年级的“正常授课时间”冲突。 | 基础规则。 |
| H-E-03 | 教师可用性 | **请假**：已请假的教师在请假时段内 _不可_ 排监考。 | 基础规则。 |
| H-E-04 | 教师可用性 | **改卷时间 (R-E-L-001)**：某科目（如语文）在 T 天考完后，该科目的所有任课教师，在 T+1 天（及之后）的**所有考试时段**均无法参与监考。 | 此条确认为“硬约束”。 **设计影响**：逻辑为在 T+1 天将这些教师设为“不可用”。 |
| H-E-05 | 回避规则 | **学科回避**：教师 _不能_ 监考自己所任教的科目。 | 基础规则。 |
| H-E-06 | 考场规则 | **考场模式 (R-E-S-001)**：系统 _必须_ 支持“原班考试”和“打乱考场”两种模式。 | **更新**：算法必须按我们讨论的细则（如“打乱”模式下先锁定自习室）执行。 |
| H-E-07 | 考场规则 | **学生匹配**：系统 _必须_ 根据学生的“选课情况”（如物化生），将其正确分配到“对应考场”或“自习室”。 | 基础规则。 |
| H-E-08 | 结构约束 | **时段上限**：同一个半天最多安排 3 场考试（长时科目可能 2 场）。 | 基础规则。 |
| H-E-09 | 数据计入 | **固定任务计入 (R-E-C-001)**：教师固定的“坐班”时间（如第9节课） _必须_ 计入“自习坐班总时长”，用于后续的公平性计算。 | 基础规则。 |


#### C2.2. 软约束 (S) - 优化目标 (权重可调)
| **约束ID** | **约束类型** | **规则描述** | **备注** |
| --- | --- | --- | --- |
| **S-E-01** | **核心公平性 (历史)** | **历史公平性 (R-E-B-001)**：追求“**加权总负荷**”的均衡。      - **量化指标**：`总负荷 = (W_cur * 本次核算负荷) + (W_hist * 本学期历史核算负荷)`   - **历史权重 (W)**：由 B2 功能设置（如：`W_cur=0.5`, `W_hist=0.5`）   - **优化目标**：最小化所有教师“总负荷”的“波动”。 | **(已更新)** `本次核算负荷` 的算法见 S-E-02。 |
| **S-E-02** | **核心公平性 (当次)** | **当次任务负荷 (R-E-B-003)**：定义“**本次核算负荷**”的计算方式。      - **量化指标**：`本次核算负荷 = (本次监考时长 * C_inv) + (本次自习坐班时长 * C_sup)`   - **负荷系数 (C)**：由 B2 新功能设置（如：`C_inv=1.0`, `C_sup=0.5`） | **(已更新)** 此规则为 S-E-01 提供了计算的**基础**。 |
| S-E-03 | 辅助公平性 | **长时科目平衡 (R-E-B-002)**：_避免_ 某位老师承担过多的“长时科目”（如语数外）监考。 | 权重相对 S-E-01 较低，作为调优项。 |
| S-E-04 | 教师工作负荷 | **午休保障**：_不要_ 连续安排“上午最后一场”和“下午第一场”。 | 基础规则。 |
| S-E-05 | 教师工作负荷 | **任务集中度**：_优先_ 将教师的监考任务集中在“半天内完成”，留出完整的另一半天。 | 基础规则。 |
| S-E-06 | 教师工作负荷 | **每日负荷**：一天安排 2 “场”（按次数，非时长）比较舒服。 | 基础规则。(此处澄清为按“次”计算) |




